<center><h1><b>后端场景应用</b></h1><center>



# 一、基础架构类

## 1、设计一个 SSO（单点登录）系统

- **应用场景：**企业内部系统、互联网产品矩阵（多平台账号互通）、政务&医疗行业（统一身份认证）、第三方授权登录（OAuth）

- **需求分析：**允许用户   在多个系统中只需要登入一次 ，就能访问所有相关应用，避免重复登录。
- **具体实现：**
  1. 设计一个认证接口、认证成功后存入Redis
  2. 业务系统校验Token，每次请求都需要携带Token
  3. SSO推出机制，SSO推出有所有Token失效。
  4. 提供刷新Token机制，防止长时间位操作导致过期。
  5. 防止CSRF攻击。

## 2、设计一套百万级 QPS 高并发秒杀系统，你如何设计？

- **需求分析：**在**极端高并发**场景下，确保 **库存精准扣减**、**系统稳定性** 和 **订单一致性**，避免超卖、数据库崩溃。
- **具体实现：**
  1. 请求限流
     - CDN缓存商品页面

     - nginx+限流（基于IP或者ID用户限流）
     - Redis 令牌桶限流，1秒最多1000个请求
  2. 秒杀库存管理Redis（Redis预扣减）

     - Redis预加载库存，避免数据库压力。
     - Lua脚本原子扣减库尊，确保线程安全。
     - 库存不尊直接返回失败，不访问数据库。
     - 成功后异步写入数据库（MQ处理）。

  3. 异步下单（削峰）

     - 成功扣减库存后，订单写入MQ（入Kafka，RabibitMQ）
     - 后台订单服务消费MQ 并创建订单。
     - 数据库真正扣减库存，防止并发冲突。

  4. 数据库优化

     - 库存字段加行锁
     - 数据库分库分表
     - 使用 Elasticsearch 代替 MySQL 进行订单查询

## 3、发送验证码短信接口如何设计？

- **需求分析：**短信验证码接口需要安全、稳定、高效防止恶意刷短信，同时保证用户体验、验证码防刷、5-10分钟、重复发送限制、校验机制。
- **功能实现：**
  1. 数据表设计、验证码信息表。
  2. Redis限流设计
     - 限制每个手机号60秒只能请求一次。
     - 记录验证码Redis  五分钟内有效
  3. API设计
     - 发送验证码接口、校验验证码接口。

## 4、将100万条数据导出成文件你如何处理？

- **需求分析：**导出100万条数据，生成文件，用户进行下载。

- **功能实现：**

  1. **数据层优化：**避免一次查询100万条、采用分页查询或游标查询。
  2. **数据处理优化：**使用流式处理，逐条写入文件，避免占用过多内存。
  3. **异步处理：**对于大规模的导出任务，使用消息队列中间件后台执行，导出后完成提供下载链接。

  

## 5、用户权限表结构怎么设计？

- **需求分析：**权限管理设计用户、角色、权限、资源、四个核心概念，考虑到高并发和可拓展性、数据库需要分库分表、并结合缓存优化查询，RBAC/RBGAC。

- **具体实现：**
  1. 数据库表结构
     - 用户表、角色表、权限表、角色关联权限表、权限关联角色表
  2. 查询优化 & 缓存
     - 数据库方面添加索引、加入缓存，更新权限时删除缓存。
  3. 高并发方案
     - Redis缓存权限，减少数据库查询
     - MYSQL分库分表，提升查询性能。
     - API网关+限流（Nginx/Redis令牌桶）

# 二、数据存储 & 缓存设计

## 1、如何设计一个高可用的 Redis 集群？

- **需求分析： **高可用性（HA）、负载均衡、数据持久化** 和 **容灾恢复**。以下**
- **功能实现：**
  1. **主从模式：**读多写少，主库写，从库毒，可手动切换主库。
  2. **哨兵模式：**业务可容忍短时故障，自动故障转移，适合小规模集群。
  3. **分片集群：** 高并发、大数据量，多主多从，支持数据自动分片，
  4. **代理&分片：** 业务透明化

## 2、如何设计一个可以存储 10 亿条数据的日志系统？

- **需求分析：**对于 10 亿级别的日志数据，核心挑战是 **存储、查询、索引、归档和检索效率**。

- **功能实现：**

  1. | 方案                   | 适用场景                | 优势                                  |
     | ---------------------- | ----------------------- | ------------------------------------- |
     | **Elasticsearch**      | **全文搜索、实时查询**  | 倒排索引 + 分布式架构，适合高并发查询 |
     | **MySQL**              | 结构化日志，低频查询    | 传统数据库，适合小规模日志存储        |
     | **ClickHouse（推荐）** | **海量日志 + 高速查询** | 列存储 + 高压缩率，支持 PB 级数据     |

     - **日志量 < 1 亿条**  MySQL（简单存储）。
     - **日志量 1-10 亿条**  Elasticsearch（支持全文搜索）。
     - **日志量 > 10 亿条**  ClickHouse（高效查询 + 低存储成本）。

## 3、如何在 MySQL 中高效存储和查询 1 亿条用户订单数据？

- **需求分析：** 如何在 MySQL 中高效存储和查询 1 亿条用户订单数据？
- **功能实现：**
  1. 数据库设计采用分库分表 水平拆分。
  2. 合理建立索引、定期监控索引使用情况。
  3. 查询优化
  4. 读写分离

# 三、中间件 & 异步设计

## 1、如何设计一个支持高吞吐的消息队列？

- **需求分析：**设计一个支持高吞吐的消息队列系统。
- **功能实现：**
  1. 分布式集群
  2. 写入与存储
  3. 数据复制与持久化
  4. 网络 I/O 与传输
  5. 消费模型

## 2、如何确保消息队列的消息不丢失、不重复消费？

- **需求分析：**消息队列消息不丢失。
- **功能实现：**
  1. **生产端** 开启持久化 （RabbitMQ `persistent`）、重试机制、发送失败时。
  2. **重试机制：**失败达到一定次数，写入本地日志或数据库进行补偿。**
  3. **持久化存储：**

## 3、如何设计一个支持延迟队列的订单超时取消功能？

- **需求分析：**未支付订单在30分钟后自动取消，释放库存、需要支持高并发，订单超时后及时出发取消逻辑。

- **功能实现：**

  1. RabbitMQ死信队列：自动出发，不需要手动轮询。
  2. 发送刀订单队列TTL=30分钟。
  3. 过期后进行监听消息，检查订单状态。

  